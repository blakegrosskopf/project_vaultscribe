#:import get_color_from_hex kivy.utils.get_color_from_hex

<MDTextField>:
    color_mode: "custom"
    line_color_normal: get_color_from_hex("#FFFFFF55")
    line_color_focus:  1, 1, 1, 1
    text_color_normal: 1, 1, 1, 1
    text_color_focus:  1, 1, 1, 1
    hint_text_color_normal: get_color_from_hex("#FFFFFF99")
    hint_text_color_focus:  1, 1, 1, 1
    cursor_color: 1, 1, 1, 1
    icon_right_color: 1, 1, 1, 1
    hint_icon_right_color: 1, 1, 1, 1

<MDDialog>:
    md_bg_color: 0.26, 0.3, 0.59, 1
    elevation: 8
    radius: [12, 12, 12, 12]
    title_color: 1, 1, 1, 1
    text_color: 1, 1, 1, 1

# ===================================================================

<homeScreen>:
    canvas.before:
        Color:
            rgba: 0.286, 0.333, 0.667, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Image:
            source: "../assets/logo.png"
            size_hint: None, None
            width: "400dp"
            height: "180dp"
            allow_stretch: True
            keep_ratio: True
            mipmap: True
            nocache: True
            pos_hint: {"center_x": 0.5, "top": 0.92}

        MDCard:
            size_hint: 0.92, None
            pos_hint: {"center_x": 0.5, "center_y": 0.44}
            height: self.minimum_height
            padding: "16dp"
            radius: [18]
            md_bg_color: 0.26, 0.3, 0.59, 1
            BoxLayout:
                orientation: "vertical"
                spacing: "12dp"
                size_hint_y: None
                height: self.minimum_height

                MDTextField:
                    id: user
                    hint_text: "Email"
                    icon_right: "account"
                    multiline: False
                    size_hint_y: None
                    height: "56dp"
                    _no_floating_label: True

                MDTextField:
                    id: psswd
                    hint_text: "Password"
                    password: True
                    icon_right: "eye-off"
                    multiline: False
                    size_hint_y: None
                    height: "56dp"
                    _no_floating_label: True

                BoxLayout:
                    size_hint_y: None
                    height: "30dp"
                    spacing: "16dp"

                    BoxLayout:
                        spacing: "6dp"
                        size_hint_x: 1
                        MDCheckbox:
                            id: cb_show
                            size_hint: None, None
                            width: "22dp"
                            height: "22dp"
                            on_active:
                                psswd.password = not self.active
                                psswd.icon_right = "eye" if self.active else "eye-off"
                        MDLabel:
                            text: "Show Password"
                            font_size: "14dp"
                            size_hint_x: None
                            width: "140dp"
                            halign: "left"
                            valign: "middle"
                            color: 1, 1, 1, 1

                BoxLayout:
                    size_hint_y: None
                    height: "44dp"
                    spacing: "10dp"
                    MDFlatButton:
                        text: "Sign in"
                        font_size: "20dp"
                        md_bg_color: "#303F9F"
                        theme_text_color: "Custom"
                        text_color: 1,1,1,1
                        on_press: root.verify(user.text, psswd.text)
                    MDFlatButton:
                        text: "Create account"
                        font_size: "20dp"
                        md_bg_color: "#303F9F"
                        theme_text_color: "Custom"
                        text_color: 1,1,1,1
                        on_press:
                            root.manager.current = 'signUp'
                            root.clear_fields()

        MDLabel:
            text: "Transcribed, Encrypted, and Secured."
            halign: "center"
            font_size: "15dp"
            color: 1, 1, 1, 0.9
            size_hint: 1, None
            height: "28dp"
            pos_hint: {"center_x": 0.5, "y": 0.14}

        MDLabel:
            text: "[ref=Reset Password]Reset Password[/ref]"
            markup: True
            font_size: "15dp"
            halign: "center"
            color: 1, 1, 1, 1
            size_hint: 1, None
            height: "40dp"
            pos_hint: {"center_x": 0.5, "y": 0.02}
            on_ref_press:
                root.manager.current = 'changeScreen'
                root.clear_fields()


<signUp>:
    canvas.before:
        Color:
            rgba: 0.286, 0.333, 0.667, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Image:
            source: "../assets/logo.png"
            size_hint: None, None
            width: "400dp"
            height: "180dp"
            allow_stretch: True
            keep_ratio: True
            pos_hint: {"center_x": 0.5, "top": 0.92}

        MDCard:
            size_hint: 0.92, None
            pos_hint: {"center_x": 0.5, "center_y": 0.44}
            height: self.minimum_height
            padding: "16dp"
            radius: [18]
            md_bg_color: 0.26, 0.3, 0.59, 1
            BoxLayout:
                orientation: "vertical"
                spacing: "12dp"
                size_hint_y: None
                height: self.minimum_height

                MDTextField:
                    id: username_input
                    hint_text: "Email"
                    icon_right: "account"
                    multiline: False
                    size_hint_y: None
                    height: "56dp"
                    _no_floating_label: True

                MDTextField:
                    id: password_input
                    hint_text: "Password"
                    password: True
                    icon_right: "eye-off"
                    multiline: False
                    size_hint_y: None
                    height: "56dp"
                    _no_floating_label: True

                BoxLayout:
                    id: cBox
                    size_hint_y: None
                    height: "30dp"
                    spacing: "8dp"
                    MDCheckbox:
                        id: cb
                        size_hint: None, None
                        width: "28dp"
                        height: "28dp"
                        on_press:
                            password_input.password = not password_input.password
                            password_input.icon_right = "eye" if password_input.icon_right == "eye-off" else "eye-off"
                    MDLabel:
                        text: "Show Password"
                        font_size: "14dp"
                        size_hint_x: None
                        width: "140dp"
                        color: 1, 1, 1, 1

                BoxLayout:
                    id: sBox
                    size_hint_y: None
                    height: "40dp"
                    spacing: "10dp"
                    MDFlatButton:
                        text: "Create account"
                        font_size: "18dp"
                        md_bg_color: "#1E88E5"
                        theme_text_color: "Custom"
                        text_color: 1,1,1,1
                        on_press: root.create_user(username_input.text, password_input.text)
                    MDFlatButton:
                        text: "Back"
                        font_size: "18dp"
                        md_bg_color: "#303F9F"
                        theme_text_color: "Custom"
                        text_color: 1,1,1,1
                        on_press:
                            root.manager.current = 'home'
                            root.clear_fields()

        MDLabel:
            text: "Create your secure, local-first account."
            halign: "center"
            font_size: "15dp"
            color: 1, 1, 1, 0.9
            size_hint: 1, None
            height: "28dp"
            pos_hint: {"center_x": 0.5, "y": 0.14}


<changeScreen>:
    canvas.before:
        Color:
            rgba: 0.286, 0.333, 0.667, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Image:
            source: "../assets/logo.png"
            size_hint: None, None
            width: "400dp"
            height: "180dp"
            allow_stretch: True
            keep_ratio: True
            pos_hint: {"center_x": 0.5, "top": 0.92}

        MDCard:
            size_hint: 0.92, None
            pos_hint: {"center_x": 0.5, "center_y": 0.44}
            height: self.minimum_height
            padding: "16dp"
            radius: [18]
            md_bg_color: 0.26, 0.3, 0.59, 1
            BoxLayout:
                orientation: "vertical"
                spacing: "12dp"
                size_hint_y: None
                height: self.minimum_height

                MDTextField:
                    id: email
                    hint_text: "Email"
                    icon_right: "account"
                    multiline: False
                    size_hint_y: None
                    height: "56dp"
                    _no_floating_label: True

                BoxLayout:
                    size_hint_y: None
                    height: "40dp"
                    spacing: "10dp"
                    MDFlatButton:
                        text: "Submit"
                        font_size: "18dp"
                        md_bg_color: "#1E88E5"
                        theme_text_color: "Custom"
                        text_color: 1,1,1,1
                        on_press: root.start_password_reset(email.text)
                    MDFlatButton:
                        text: "Back"
                        font_size: "18dp"
                        md_bg_color: "#303F9F"
                        theme_text_color: "Custom"
                        text_color: 1,1,1,1
                        on_press: root.manager.current = 'home'

        MDLabel:
            text: "Lost your key? Reset it securely."
            halign: "center"
            font_size: "15dp"
            color: 1, 1, 1, 0.9
            size_hint: 1, None
            height: "28dp"
            pos_hint: {"center_x": 0.5, "y": 0.14}


<sScreen>:
    canvas.before:
        Color:
            rgba: 0.286, 0.333, 0.667, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Image:
            source: "../assets/logo.png"
            size_hint: None, None
            width: "400dp"
            height: "180dp"
            allow_stretch: True
            keep_ratio: True
            pos_hint: {"center_x": 0.5, "top": 0.92}

        MDCard:
            size_hint: 0.92, None
            pos_hint: {"center_x": 0.5, "center_y": 0.18}
            height: "100dp"
            padding: "12dp"
            radius: [18]
            md_bg_color: 0.26, 0.3, 0.59, 1
            BoxLayout:
                orientation: "vertical"
                spacing: "10dp"
                MDLabel:
                    text: "[b]Securely Signed-In[/b]"
                    markup: True
                    halign: "center"
                    font_size: "30dp"
                    color: 1, 1, 1, 1
                BoxLayout:
                    spacing: "6dp"
                    orientation: "horizontal"
                    MDFlatButton:
                        id: lBox
                        text: "[b]Log out[/b]"
                        markup: True
                        font_size: "14dp"
                        md_bg_color: "#1E88E5"
                        theme_text_color: "Custom"
                        text_color: 1,1,1,1
                        halign: "center"
                        size_hint_x: 0.5
                        on_press: root.logout()
                    MDFlatButton:
                        text: "[b]Exit Application[/b]"
                        markup: True
                        font_size: "14dp"
                        md_bg_color: "#D32F2F"
                        theme_text_color: "Custom"
                        size_hint_x: 0.5
                        halign: "center"
                        text_color: 1,1,1,1
                        on_press: app.stop()

        MDCard:
            size_hint: 0.92, 0.26
            pos_hint: {"center_x": 0.5, "y": 0.32}
            height: "210dp"
            padding: "20dp"
            radius: [18]
            md_bg_color: 0.26, 0.3, 0.59, 1
            BoxLayout:
                orientation: "vertical"
                spacing: "10dp"
                MDLabel:
                    text: "[b]Home[/b]"
                    markup: True
                    halign: "center"
                    valign: "top"
                    font_size: "34dp"
                    color: 1, 1, 1, 0.9
                BoxLayout:
                    orientation: "horizontal"
                    spacing: "6dp"
                    MDFlatButton:
                        text: "[b]Transcribe[/b]"
                        markup: True
                        font_size: "18dp"
                        md_bg_color: "#303F9F"
                        theme_text_color: "Custom"
                        text_color: 1,1,1,1
                        size_hint_x: 0.5
                        size_hint_y: 1
                        on_press: root.manager.current = 'transcribeScreen'
                    MDFlatButton:
                        text: "[b]Storage[/b]"
                        markup: True
                        font_size: "18dp"
                        md_bg_color: "#303F9F"
                        size_hint_x: 0.5
                        size_hint_y: 1
                        theme_text_color: "Custom"
                        text_color: 1,1,1,1
                        on_press: root.manager.current = 'storageScreen'
                BoxLayout:
                    orientation: "horizontal"
                    spacing: "6dp"
                    MDFlatButton:
                        text: "[b]Settings[/b]"
                        markup: True
                        font_size: "18dp"
                        md_bg_color: "#303F9F"
                        theme_text_color: "Custom"
                        text_color: 1,1,1,1
                        size_hint_x: 0.5
                        size_hint_y: 1
                        on_press: root.manager.current = 'settingsScreen'
                    MDFlatButton:
                        text: "[b]Help[/b]"
                        markup: True
                        font_size: "18dp"
                        md_bg_color: "#303F9F"
                        size_hint_x: 0.5
                        size_hint_y: 1
                        theme_text_color: "Custom"
                        text_color: 1,1,1,1
                        on_press: root.manager.current = 'helpScreen'


<TranscribeScreen>:
    name: "transcribeScreen"
    canvas.before:
        Color:
            rgba: 0.286, 0.333, 0.667, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Image:
            source: "../assets/logo.png"
            size_hint: None, None
            width: "400dp"
            height: "120dp"
            allow_stretch: True
            keep_ratio: True
            pos_hint: {"center_x": 0.5, "top": 0.96}

        MDCard:
            size_hint: 0.92, None
            pos_hint: {"center_x": 0.5, "y": 0.42}
            height: self.minimum_height
            padding: "16dp"
            radius: [18]
            md_bg_color: 0.26, 0.3, 0.59, 1
            BoxLayout:
                orientation: "vertical"
                spacing: "10dp"
                size_hint_y: None
                height: self.minimum_height

                MDLabel:
                    text: "[b]Transcribe Meeting[/b]"
                    markup: True
                    font_size: "22dp"
                    halign: "center"
                    color: 1, 1, 1, 1

                MDTextField:
                    id: audio_path_input
                    hint_text: "Selected audio file"
                    icon_right: "file"
                    readonly: True
                    multiline: False
                    size_hint_y: None
                    height: "50dp"
                    _no_floating_label: True

                BoxLayout:
                    size_hint_y: None
                    height: "44dp"
                    spacing: "10dp"
                    MDFlatButton:
                        text: "[b]Choose file[/b]"
                        markup: True
                        font_size: "16dp"
                        md_bg_color: "#1E88E5"
                        theme_text_color: "Custom"
                        text_color: 1,1,1,1
                        on_press: root.open_file_manager()
                    MDFlatButton:
                        id: transcribe_btn
                        text: "[b]Transcribe[/b]"
                        markup: True
                        font_size: "16dp"
                        md_bg_color: "#43A047"
                        theme_text_color: "Custom"
                        text_color: 1,1,1,1
                        on_press: root.start_transcription()

                MDFlatButton:
                    text: "[b]Back[/b]"
                    markup: True
                    font_size: "16dp"
                    md_bg_color: "#303F9F"
                    theme_text_color: "Custom"
                    text_color: 1,1,1,1
                    size_hint_y: None
                    height: "40dp"
                    on_press: root.manager.current = 'sScreen'

        MDCard:
            size_hint: 0.92, 0.36
            pos_hint: {"center_x": 0.5, "y": 0.03}
            padding: "12dp"
            radius: [18]
            md_bg_color: 0.26, 0.3, 0.59, 1
            BoxLayout:
                orientation: "vertical"
                spacing: "6dp"

                MDLabel:
                    text: "[b]Summary (copy as needed)[/b]"
                    markup: True
                    font_size: "16dp"
                    color: 1,1,1,1
                    size_hint_y: None
                    height: "24dp"

                MDTextField:
                    id: summary_output
                    hint_text: "Summary will appear here"
                    readonly: True
                    multiline: True
                    size_hint_y: 1
                    _no_floating_label: True


<StorageScreen>:
    name: "storageScreen"
    canvas.before:
        Color:
            rgba: 0.286, 0.333, 0.667, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Image:
            source: "../assets/logo.png"
            size_hint: None, None
            width: "400dp"
            height: "120dp"
            allow_stretch: True
            keep_ratio: True
            pos_hint: {"center_x": 0.5, "top": 0.96}

        MDCard:
            size_hint: 0.92, 0.5
            pos_hint: {"center_x": 0.5, "y": 0.29}
            padding: "16dp"
            radius: [18]
            md_bg_color: 0.26, 0.3, 0.59, 1
            BoxLayout:
                orientation: "vertical"
                spacing: "8dp"

                MDLabel:
                    text: "[b]Saved Meetings[/b]"
                    markup: True
                    font_size: "22dp"
                    halign: "center"
                    color: 1,1,1,1
                    size_hint_y: None
                    height: "26dp"

                MDLabel:
                    text: "Select a meeting to view its transcript and summary."
                    font_size: "14dp"
                    halign: "center"
                    color: 1,1,1,0.9
                    size_hint_y: None
                    height: "22dp"

                ScrollView:
                    bar_color: 1,1,1,0.7
                    bar_width: "4dp"
                    MDList:
                        id: storage_list

        MDCard:
            size_hint: 0.92, 0.26
            pos_hint: {"center_x": 0.5, "y": 0.02}
            padding: "12dp"
            radius: [18]
            md_bg_color: 0.26, 0.3, 0.59, 1
            BoxLayout:
                orientation: "vertical"
                spacing: "6dp"

                MDLabel:
                    text: "[b]Details (copy text as needed)[/b]"
                    markup: True
                    font_size: "16dp"
                    color: 1,1,1,1
                    size_hint_y: None
                    height: "24dp"

                MDTextField:
                    id: storage_detail
                    hint_text: "Transcript and summary details will appear here"
                    readonly: True
                    multiline: True
                    size_hint_y: 1
                    _no_floating_label: True

        MDFlatButton:
            text: "[b]Back[/b]"
            markup: True
            font_size: "16dp"
            md_bg_color: "#303F9F"
            theme_text_color: "Custom"
            text_color: 1,1,1,1
            size_hint: 0.38, None
            height: "40dp"
            pos_hint: {"center_x": 0.5, "y": 0.30}
            on_press: root.manager.current = 'sScreen'


<SettingsScreen>:
    name: "settingsScreen"
    canvas.before:
        Color:
            rgba: 0.286, 0.333, 0.667, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Image:
            source: "../assets/logo.png"
            size_hint: None, None
            width: "400dp"
            height: "120dp"
            allow_stretch: True
            keep_ratio: True
            pos_hint: {"center_x": 0.5, "top": 0.96}

        MDCard:
            size_hint: 0.92, 0.60
            pos_hint: {"center_x": 0.5, "center_y": 0.50}
            padding: "16dp"
            radius: [18]
            md_bg_color: 0.26, 0.3, 0.59, 1
            BoxLayout:
                orientation: "vertical"
                spacing: "10dp"

                MDLabel:
                    text: "[b]Settings[/b]"
                    markup: True
                    font_size: "26dp"
                    halign: "center"
                    color: 1,1,1,1
                    size_hint_y: None
                    height: "30dp"

                MDLabel:
                    text: "This prototype focuses on secure login and local-first meeting handling.\n\nFuture settings will include per-user encryption options, retention windows, and export controls."
                    font_size: "14dp"
                    halign: "center"
                    color: 1,1,1,0.9

        MDFlatButton:
            text: "[b]Back[/b]"
            markup: True
            font_size: "16dp"
            md_bg_color: "#303F9F"
            theme_text_color: "Custom"
            text_color: 1,1,1,1
            size_hint: 0.38, None
            height: "40dp"
            pos_hint: {"center_x": 0.5, "y": 0.12}
            on_press: root.manager.current = 'sScreen'


<HelpScreen>:
    name: "helpScreen"
    canvas.before:
        Color:
            rgba: 0.286, 0.333, 0.667, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        Image:
            source: "../assets/logo.png"
            size_hint: None, None
            width: "400dp"
            height: "120dp"
            allow_stretch: True
            keep_ratio: True
            pos_hint: {"center_x": 0.5, "top": 0.96}

        MDCard:
            size_hint: 0.92, 0.60
            pos_hint: {"center_x": 0.5, "center_y": 0.50}
            padding: "16dp"
            radius: [18]
            md_bg_color: 0.26, 0.3, 0.59, 1
            BoxLayout:
                orientation: "vertical"
                spacing: "10dp"

                MDLabel:
                    text: "[b]Help & About[/b]"
                    markup: True
                    font_size: "26dp"
                    halign: "center"
                    color: 1,1,1,1
                    size_hint_y: None
                    height: "30dp"

                MDLabel:
                    text: "LoginSystemDesktop is the secure front-end for VaultScribe.\n\n• Accounts are protected with Argon2id hashing and TOTP-based 2FA.\n• Meeting audio is transcribed locally, then summarized for review.\n• Stored summaries can be copied from the Storage screen for documentation."
                    font_size: "14dp"
                    halign: "center"
                    color: 1,1,1,0.9

        MDFlatButton:
            text: "[b]Back[/b]"
            markup: True
            font_size: "16dp"
            md_bg_color: "#303F9F"
            theme_text_color: "Custom"
            text_color: 1,1,1,1
            size_hint: 0.38, None
            height: "40dp"
            pos_hint: {"center_x": 0.5, "y": 0.12}
            on_press: root.manager.current = 'sScreen'
